/*! v0.1.0 Build Thu Aug 06 2015 16:57:14 GMT+0300 (MSK) */
!function(){var e={},t=function(){var t,n,r,o=Array.prototype.slice.call(arguments,0);"string"==typeof o[0]?(r=o[0],t=o[1],n=o[2]):Array.isArray(o[0])&&(t=o[0],n=o[1]);var a=t.reduce(function(e,t){return e.addDependency(t)},tau.mashups);return a=a.addDependency(r+"/config"),a=a.addMashup(function(){var o=Array.prototype.slice.call(arguments,0);if(t.length>0&&1===o.length)throw new Error("Can't properly load dependencies for mashup \""+r+'", mashup is stopped.');return e.variables=o[o.length-1],o.length-t.length===2?e.config=o[o.length-2]:e.config={},Object.freeze&&(Object.freeze(e.variables),Object.freeze(e.config),Object.freeze(e)),n.apply(null,o)})};t("CustomUnitQuickAddComment",["react","tau/configurator","jQuery","tau/models/board.customize.units/const.entity.types.names","tau/models/board.customize.units/const.card.sizes","tau/models/board.customize.units/board.customize.units.interaction"],function(t,n,r,o,a,i){return function(t){function n(e){if(r[e])return r[e].exports;var o=r[e]={exports:{},id:e,loaded:!1};return t[e].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var r={};return n.m=t,n.c=r,n.p="",n.p=e.variables?e.variables.mashupPath:n.p,n(0)}([function(e,t,n){e.exports=n(3)},,,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var o=n(4),a=r(o),i=n(5),u=n(14),s=r(u),c=n(15),l=r(c);i.customUnits.add({id:"add_comment",name:"Add Comment",template:s["default"],sizes:[i.customUnits.sizes.LIST]}),a["default"].render(a["default"].createElement(l["default"],null),document.querySelector("#RestUI_Board"))},function(e,n){e.exports=t},function(e,t,n){"use strict";var r=n(6),o=n(9),a=n(10);e.exports={addBusListener:o.addBusListener,addBusListenerOnce:o.addBusListenerOnce,getAppConfigurator:r.getAppConfigurator,configurator:r,events:o,customUnits:a}},function(e,t,n){"use strict";var r=n(7),o=n(8),a=new o.Deferred;r.getGlobalBus().once("configurator.ready",function(e,t){a.resolve(t)});var i=function(){return a.promise()};e.exports={getAppConfigurator:i}},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){"use strict";var r=n(7),o=r.getBusRegistry(),a=function(e){return function(){e.apply(null,Array.prototype.slice(arguments).slice(1))}},i=function(e,t,n,r){var i=a(function(o){var a=o.bus;a.name===e&&a[r?"once":"on"](t,n)}),u=o.addEventListener("create",i);return o.addEventListener("destroy",a(function(r){var o=r.bus;o.name===e&&o.removeListener(t,n,u)})),{remove:function(){o.removeListener("create",i,u),o.getBusRegistry().getByName(e).then(function(e){e.removeListener(t,n,u)})}}},u=function(e,t,n){return i(e,t,n,!0)};e.exports={addBusListener:i,addBusListenerOnce:u}},function(e,t,n){"use strict";var r=n(11),o=n(12),a=n(13).openUnitEditor,i=n(6),u=function(e){return e=e||{},e.types=e.types||[r.ANY_TYPE],e.sizes=e.sizes||Object.keys(o).map(function(e){return o[e]}),i.getAppConfigurator().then(function(t){var n=t.getUnitsRegistry();if(!e.id)throw new Error('Field "id" is required for custom unit config');if(n.units[e.id])throw new Error('Custom unit with id "'+e.id+'" has been already registered');e.name=e.name||e.id,e.model=e.model||e.sampleData?e.model:{dummy:1},"string"!=typeof e.model&&"object"==typeof e.model&&(e.model=Object.keys(e.model).reduce(function(t,n){return t.concat(n+":"+e.model[n])},[]).join(", ")),e.sampleData=e.sampleData||{},e.template=e.template||{markup:['<div class="tau-board-unit__value">'+e.id+"</div>"]},"string"==typeof e.template&&(e.template={markup:[e.template]}),"string"==typeof e.template.markup&&(e.template.markup=[e.template.markup]),e.outerClassName&&(e.classId=e.outerClassName),e.isEditable&&(e.interactionConfig={isEditable:e.isEditable},e.editorHandler?e.interactionConfig.handler=e.editorHandler:e.interactionConfig.handler=function(t,n){var r=t.cardDataForUnit,o=e.editorComponentName instanceof Function?e.editorComponentName(r):e.editorComponentName,i=a(o,{});if(e.editorData){var u={};Object.keys(e.editorData).forEach(function(t){var n=e.editorData[t];u[t]=n instanceof Function?n(r):r[n]}),t.cardDataForUnit=u}return i(t,n)}),n.units[e.id]=n.register([e])[e.id]})};e.exports={types:r,sizes:o,add:u}},function(e,t){e.exports=o},function(e,t){e.exports=a},function(e,t){e.exports=i},function(e,t){e.exports='<div class=tau-board-unit__value><span class="tau-btn tau-btn_hidden cu-quickaddcomment-trigger" style="height: auto; padding-bottom: 3px">Add</span></div>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,a=t,i=n;u=c=s=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,a);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(i)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=a,n=i,r=!0}},s=n(4),c=r(s),l=n(8),d=r(l),p=n(7),f=r(p),m=n(16),y=r(m),v=f["default"].getApplicationPath(),b=function(e){function t(){var e=this;o(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.state={isActive:!1},this.handleSubmit=function(t){return e.setState({isActive:!1}),d["default"].ajax({type:"post",url:v+"/api/v1/Comments/",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({general:{id:e.state.entityId},description:t})})},this.handleClose=function(){e.setState({isActive:!1})}}return a(t,e),i(t,[{key:"componentDidMount",value:function(){var e=this;this.clickListener=function(t){t.stopPropagation();var n=d["default"](t.target).parents(".i-role-card").data("entityId");e.setState({entityId:n,isActive:n!==e.state.entityId?!0:!e.state.isActive,target:t.target})},d["default"](document.body).on("click",".i-role-card .cu-quickaddcomment-trigger",this.clickListener)}},{key:"componentWillUnmount",value:function(){d["default"](document.body).off("click",".i-role-card .cu-quickaddcomment-trigger",this.clickListener)}},{key:"render",value:function(){var e=this.state.isActive;return e?c["default"].createElement(y["default"],{key:this.state.entityId,target:this.state.target,onSubmit:this.handleSubmit,onClose:this.handleClose,onOuterClick:this.handleClose}):null}}]),t}(c["default"].Component);t["default"]=b,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,a=t,i=n;u=c=s=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,a);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(i)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=a,n=i,r=!0}},s=n(4),c=r(s),l=n(17),d=r(l),p=n(18),f=r(p),m=n(8),y=r(m),v=function(e){function t(){var e=this;o(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.handleSubmit=function(t){t.preventDefault(),e.props.onSubmit(e.refs.value.value)},this.handleClickCancel=function(){e.props.onClose()},this.handleOuterClick=function(){e.props.onOuterClick()}}return a(t,e),i(t,[{key:"componentWillUnmount",value:function(){y["default"](this.props.target).css("visibility","")}},{key:"render",value:function(){var e=this.props.target;y["default"](e).css("visibility","visible");var t=c["default"].createElement("div",{style:{display:"-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex",backgroundColor:"white",borderRadius:"3",padding:"5"}},c["default"].createElement("form",{onSubmit:this.handleSubmit},c["default"].createElement("div",{style:{marginBottom:"5"}},c["default"].createElement(d["default"],{ref:"value"})),c["default"].createElement("div",null,c["default"].createElement("button",{type:"submit",className:"tau-btn tau-btn-green"},"Submit"),c["default"].createElement("button",{type:"button",onClick:this.handleClickCancel,className:"tau-btn"},"Cancel"))));return c["default"].createElement(f["default"],{target:e,overlay:t,onOuterClick:this.handleOuterClick})}}],[{key:"propTypes",value:{onClose:s.PropTypes.func.isRequired,onOuterClick:s.PropTypes.func.isRequired,onSubmit:s.PropTypes.func.isRequired,target:s.PropTypes.object.isRequired},enumerable:!0}]),t}(c["default"].Component);t["default"]=v,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,a=t,i=n;u=c=s=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,a);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(i)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=a,n=i,r=!0}},s=n(4),c=r(s),l=n(8),d=(r(l),"<!--markdown-->"),p=function(e){function t(){o(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return a(t,e),i(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){return e.refs.textarea.getDOMNode().focus()},0)}},{key:"render",value:function(){return c["default"].createElement("div",null,c["default"].createElement("textarea",{ref:"textarea",className:"i-role-textarea",style:{width:"300",height:"200"},autoFocus:!0}))}},{key:"value",get:function(){return d+this.refs.textarea.getDOMNode().value}}]),t}(c["default"].Component);t["default"]=p,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,a=t,i=n;u=c=s=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,a);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(i)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=a,n=i,r=!0}},s=n(4),c=r(s),l=n(8),d=r(l),p=function(e){function t(){var e=this;o(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.handleClickDocument=function(t){var n=e.props.target;t.target===c["default"].findDOMNode(n)||c["default"].findDOMNode(n).contains(t.target)||t.target===e.bubble||e.bubble.contains(t.target)||e.props.onOuterClick()}}return a(t,e),i(t,[{key:"componentDidMount",value:function(){this.span=d["default"]("<span />").appendTo("body")[0],this.renderBubble(this.props.target,this.props.overlay),this.documentListener=this.handleClickDocument.bind(this),document.body.addEventListener("click",this.documentListener)}},{key:"componentWillUnmount",value:function(){d["default"](this.props.target).tauBubble("destroy"),document.body.removeEventListener("click",this.documentListener)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.target,n=e.target;t!==n&&(d["default"](t).tauBubble("instance")&&d["default"](t).tauBubble("destroy"),this.renderBubble(n,e.overlay))}},{key:"render",value:function(){return null}},{key:"renderBubble",value:function(e,t){this.bubble=c["default"].render(t,this.span).getDOMNode(),d["default"](e).tauBubble({target:e,content:this.span,showOnCreation:!0,showEvent:"none",hideEvent:"none",documentMouseEvent:"none",stackName:"add_comment_bubble",zIndex:999}),setTimeout(function(){d["default"](e).tauBubble("instance")&&d["default"](e).tauBubble("adjustPosition")},50),setTimeout(function(){d["default"](e).tauBubble("instance")&&d["default"](e).tauBubble("adjustPosition")},100)}}],[{key:"propTypes",value:{onOuterClick:s.PropTypes.func.isRequired,overlay:s.PropTypes.node.isRequired,target:s.PropTypes.object.isRequired},enumerable:!0}]),t}(c["default"].Component);t["default"]=p,e.exports=t["default"]}])})}();